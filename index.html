<!DOCTYPE html>
<html>
  <head>
    <title>My Jitsi Test</title>
    <meta charset="utf-8" />
  </head>
  <body>
    <h1>Jitsi Test</h1>
    <video id="localVideo" autoplay playsinline muted></video>
    <video id="remoteVideo" autoplay playsinline></video>

    <script src="https://jitsi.friendswithkings.com/libs/lib-jitsi-meet.min.js"></script>
    <script src="https://jitsi.friendswithkings.com/config.js"></script>

    <script>
      const domain = "jitsi.friendswithkings.com";
      const options = config; // використовуємо той самий конфіг, що і офіційний клієнт

      const connection = new JitsiMeetJS.JitsiConnection(null, null, options);

      connection.addEventListener(JitsiMeetJS.events.connection.CONNECTION_ESTABLISHED, onConnectionSuccess);
      connection.addEventListener(JitsiMeetJS.events.connection.CONNECTION_FAILED, () => console.error("FAILED"));
      connection.connect();

      function onConnectionSuccess() {
        const conf = connection.initJitsiConference("myroom", options);
        conf.on(JitsiMeetJS.events.conference.TRACK_ADDED, track => {
          if (track.isLocal()) {
            document.getElementById("localVideo").srcObject = track.stream;
          } else {
            document.getElementById("remoteVideo").srcObject = track.stream;
          }
        });

        JitsiMeetJS.createLocalTracks({ devices: ["audio", "video"] })
          .then(tracks => {
            tracks.forEach(track => conf.addTrack(track));
          });

        conf.join();
      }
    </script>
  </body>
</html>
